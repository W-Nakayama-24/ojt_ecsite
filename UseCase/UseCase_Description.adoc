:lang: ja
:doctype: book
:toc: left
:toclevels: 3
:toc-title: 目次
:sectnums:
:sectnumlevels: 4
:sectlinks:
:imagesdir: ./_images
//画像イメージのディレクトリを指定 (NOTEやTIPのマークを持ってくる)
:icons: font
:source-highlighter: coderay 
//coderay: コード部分をハイライトさせる gem install coderay
:example-caption: 例
:table-caption: 表
:figure-caption: 図
:docname: = asciidoc-ECサイト機能仕様書
:author: Nakayama
:revnumber: 1.0
:revdate: 2020/01/17

= ECサイト 機能仕様書

== 概要
'''

このECサイトは、販売中の商品をブラウザ上に一覧表示する。 + 
利用者は表示されている商品を選んで購入でき、 + 
一覧表示する商品は検索機能で条件を指定して絞り込むことができる。


== ECサイトのユースケース
'''
ECサイトが実現する機能を3つのユースケースに分類しユースケースIDを振り分けた。 + 
分類とユースケースIDは、以下の図に表した通りである。

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/EC%E3%82%B5%E3%82%A4%E3%83%88_%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9%E5%9B%B3.png[usecase]

== 画面遷移図
'''
利用者がブラウザ上で見る画面の遷移を以下の図に表した。

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/EC%E3%82%B5%E3%82%A4%E3%83%88%20%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3.png[screentransition]

== 機能一覧

[cols="1*,3a", options="header"]
|===
|ユースケースID
|機能名称(ユースケース名称)

|UC01
|商品を一覧表示する

|UC02
|商品を購入する

|UC03
|商品を検索して表示する

|UC04
|商品データを登録する
|===

== 機能詳細
'''

=== 商品を一覧表示する

[cols="1h,3a"]
|===
|ユースケースID
|UC01

|ユースケース名称
|商品を一覧表示する

|概要
|<<image_viewall,商品一覧画面>>の表示

|優先度
|MUST

|アクター
|利用者

|トリガー
|* ECサイトのURLを指定・アクセス
* <<image_buy,購入明細画面>>で「全商品一覧へ戻る」ボタンを押下する

|事前条件
|Webブラウザを起動している

|基本フロー
|
. 利用者はECサイトのURLを指定してアクセスする
. <<image_viewall,商品一覧画面>>が表示される。

|代替フロー
|なし

|例外フロー
|なし


|事後条件
|<<image_viewall,商品一覧画面>>が表示されている

|===

[[image_viewall]]

==== 画面仕様：商品一覧画面

商品一覧画面の仕様と、実現する機能は以下の通りである。

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/screenImages/image_viewall.PNG[image_viewall]

[cols="3*,3a", options="header"]
|===
|No.
|項目名
|種別
|説明

|1
|商品情報表示領域
|表示領域
|商品の名前、税込価格、税抜価格、画像を表示する

仕様は以下の通りである

* 商品名の最大文字数: 50文字

* 価格の最大文字数: 9文字

* 商品情報表示の形式は「価格が安い順、横方向に4商品分ずつ並べて表示」とする

* 商品情報は、最大で1ページあたり12商品分表示する

* 税込価格、税抜価格は一の位から3桁毎にカンマで区切る

* 30文字以上の商品名は、31文字目以降を「…」で省略する

* 商品名にマウスオーバーすることで、商品名全体が表示される

* 商品データが0件のとき、以下のメッセージを表示する
....
商品データがありません
....

(参考画像：メッセージ表示後の画面イメージ)

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/image_noProduct.PNG[noProduct]

　

|2
|選択ボックス
|チェックボックス
|クリックすると対応する商品が「選択済み」状態になる

※再度クリックすると選択は解除される

|3
|購入ボタン
|ボタン
|クリックすると「<<_商品を購入する,商品を購入する>>」機能を実行する

|4
|検索フォーム(商品名)
|入力欄
|文字列を入力して検索条件(商品名)を指定する

|5
|検索フォーム(価格) 下限値欄
|入力欄
|整数を入力して検索条件(価格の下限値)を指定する

|6
|検索フォーム(価格) 上限値欄
|入力欄
|整数を入力して検索条件(価格の上限値)を指定する

|7
|検索ボタン
|ボタン
|クリックすると「<<_商品を検索して表示する,商品を検索して表示する>>」機能を実行する

※検索条件の指定が無いとき(すべての検索フォームに入力が無いとき)、ボタンはクリックできない

|8
|メッセージ領域
|表示領域
|ECサイトから利用者へのメッセージを表示する

(参考画像：メッセージ表示後の画面イメージ)

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/image_alert.png[alert]

|9
|全商品一覧に戻るボタン
|ボタン
|クリックすると<<image_viewall,商品一覧画面>>に遷移する

|10
|管理者メニューボタン
|ボタン
|クリックすると<<image_editData,商品データ管理画面>>に遷移する

|===

''''

=== 商品を購入する

[cols="1h,3a"]
|===
|ユースケースID
|UC02

|ユースケース名称
|商品を購入する

|概要
|利用者が商品を選択した状態で<<image_viewall,商品一覧画面>>の購入ボタンを押下すると、購入処理を行い<<image_buy,購入明細画面>>に遷移する。

|優先度
|MUST

|アクター
|利用者

|トリガー
|購入ボタンを押下する

|事前条件
|* <<image_viewall,商品一覧画面>>がブラウザに表示されている
* 購入したい商品のチェックボックスを押下し、「選択済み」状態にしている

|基本フロー
|
. 利用者はブラウザ上で購入ボタンを押下する
** [red]##「選択済み」状態の商品が無い場合## ⇒ <<exflow_uc02,例外フロー1に移行>>
** [red]##(want)選択した商品の在庫が無い場合## ⇒ <<exflow_uc02,例外フロー2に移行>>
. <<image_buy,購入明細画面>>に遷移し、購入日時、購入商品一覧、合計金額を表示する

|代替フロー
|なし

|例外フロー
|

[[exflow_uc02]]

. 購入する商品を選択していない場合
.. 購入の処理は実施せず、エラーメッセージ01を<<image_viewall,商品一覧画面>>の「⑧メッセージ領域」に表示する
.. <<image_viewall,商品一覧画面>>から遷移せずにシナリオを終了する

. (want)選択した商品の在庫が無い場合
.. 購入の処理は実施せず、エラーメッセージ02を<<image_viewall,商品一覧画面>>の「⑧メッセージ領域」に表示する
.. <<image_viewall,商品一覧画面>>から遷移せずにシナリオを終了する

|事後条件
|<<image_buy,購入明細画面>>が表示されている

|補足
|

エラーメッセージ01
....
購入に失敗しました
(商品が選択されていません)
....

エラーメッセージ02
....
購入に失敗しました
(選択した商品の在庫がありません)
....

|===
''''

[[image_buy]]
==== 画面仕様：購入明細画面

購入明細画面のイメージと、実現する機能は以下の通りである。

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/screenImages/image_buy.PNG[buy]

[cols="3*,3a", options="header"]
|===
|No.
|項目名
|種別
|説明

|1
|購入明細表示領域
|表示領域
|購入日時、購入商品一覧、合計金額(税込金額と税抜金額の両方)を表示する


|2
|全商品一覧に戻るボタン
|ボタン
|クリックすると<<image_viewall,商品一覧画面>>に遷移する

|===

''''

=== 商品を検索して表示する

[cols="1h,3a"]
|===
|ユースケースID
|UC03

|ユースケース名称
|商品を検索して表示する

|概要

|* 利用者が商品一覧画面の検索フォームに入力した文字列を含む商品のみを表示する。
* 利用者が商品一覧画面の検索フォームに入力した価格の範囲内にある商品のみを表示する。

|優先度
|MUST

|アクター
|利用者

|トリガー
|検索ボタンを押下する

|事前条件
|* <<image_viewall,商品一覧画面>>がブラウザに表示されている

|基本フロー
|
[[mainflow_uc03]]
. 利用者は検索フォームに文字列または数字を入力する
. 利用者はブラウザ上で検索ボタンを押下する
** [red]##検索フォーム(価格)に整数以外が入力されている場合##　⇒ <<altflow_uc03,代替フロー1に移行>>
** [red]##検索フォーム(価格)の下限値欄と上限値欄両方に入力があり、上限値の入力価格が下限値欄の入力価格より小さい場合
##　⇒ <<altflow_uc03,代替フロー2に移行>>
** [red]##検索フォーム(商品名)にシングルクォーテーション(')またはダブルクォーテーション(")が含まれている場合
##　⇒ <<altflow_uc03,代替フロー3に移行>>

. 検索フォームの入力内容に対応する商品のみを<<image_viewall,商品一覧画面>>の「①商品情報表示領域」に新しく表示する
** [red]##検索条件を満たす商品データが0件の場合##　⇒ <<altflow_uc03,代替フロー4に移行>>
+
(参考画像：検索実行後の画面イメージ)
+
image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/screenImages/image_search.PNG[search]




|代替フロー
|
[[altflow_uc03]]

. 検索フォーム(価格)に整数以外が入力されている場合
.. エラーメッセージ03を<<image_viewall,商品一覧画面>>の「⑧メッセージ領域」に表示する
.. <<mainflow_uc03,基本フロー>>のステップ1に戻る


. 検索フォーム(価格)の下限値欄と上限値欄両方に入力があり、上限値の入力価格が下限値欄の入力価格より小さい場合
.. エラーメッセージ04を<<image_viewall,商品一覧画面>>の「⑧メッセージ領域」に表示する
.. <<mainflow_uc03,基本フロー>>のステップ1に戻る

. 検索フォーム(商品名)にシングルクォーテーション(')またはダブルクォーテーション(")が含まれている場合
.. エラーメッセージ05を<<image_viewall,商品一覧画面>>の「⑧メッセージ領域」に表示する
.. <<mainflow_uc03,基本フロー>>のステップ1に戻る

. 検索条件を満たす商品データが0件の場合
.. 以下のメッセージを<<image_viewall,商品一覧画面>>の「①商品情報表示領域」に新しく表示する
....
ご指定の検索条件に該当する商品は見つかりませんでした
....

(参考画像：メッセージ表示後の画面イメージ)

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/image_noSearchResult.PNG[alert]

　

|例外フロー
|なし

|事後条件
|<<image_viewall,商品一覧画面>>が表示されている

|補足
|

エラーメッセージ03
....
検索フォーム(価格)の入力が正しくありません
(整数で価格を指定してください)
....

エラーメッセージ04
....
価格の範囲指定が正しくありません
(価格フォームの左側に下限値、右側に上限値を入力してください)
....

エラーメッセージ05
....
シングルクォーテーション(')またはダブルクォーテーション(")が含まれる文字列では検索できません
....

商品名の検索フォームと価格の検索フォーム両方に正しい入力があった場合は、
商品名での絞り込みと価格での絞り込みを同時に行う(AND検索を実行する)。

商品名検索、価格検索、両方を用いたAND検索はそれぞれ部分一致検索を実行する。

アルファベットを含む文字列で商品名検索をするとき、大文字と小文字は区別しない。

※ 検索フォームのバリデーション条件を以下に定義する。

* 検索フォーム(商品名)
** シングルクォーテーション(')、ダブルクォーテーション(")を除く文字列の入力を受け付ける
** 価格の検索フォームに入力がある場合のみ、空欄を認める
** 入力可能文字数制限：50文字まで

* 検索フォーム(価格)　
** 入力は整数であること
** 下限値欄のみの入力、上限値欄のみの入力を認める
** 商品名の検索フォームに入力がある場合のみ、両方とも空欄を認める
** 下限値欄と上限値欄の両方に入力があるとき、上限値欄の入力価格が下限値欄の入力価格以上であること
** 入力可能文字数制限：下限値欄、上限値欄ともに9文字まで

|===
''''


=== 商品データを登録する

[cols="1h,3a"]
|===
|ユースケースID
|UC04

|ユースケース名称
|商品データを登録する

|概要
|* 管理者から商品名,カテゴリ,税抜き価格,画像データの入力を受け付け,新しい商品データをシステムに登録する.

|優先度
|WANT

|アクター
|管理者

|トリガー
|登録ボタンを押下する

|事前条件
|* <<image_editData,商品データ管理画面>>がブラウザに表示されている

|基本フロー
|
[[mainflow_uc04]]
. 商品名フォームに文字列を入力する
. プルダウンメニューから商品カテゴリを選択する
. 価格フォームに1以上の整数を入力する
. 参照ボタンを押下し,商品画像のファイル(拡張子は.jpeg .gif .pngのいずれかで,サイズは10MB以下)を選択する
. ブラウザ上で登録ボタンを押下する
** [red]##商品名フォームにシングルクォーテーション(')またはダブルクォーテーション(")が含まれている場合
##　⇒ <<altflow_uc04,代替フロー1に移行>>
** [red]##価格フォームに整数以外が入力されている場合##　⇒ <<altflow_uc04,代替フロー2に移行>>
** [red]##画像データ登録フォームに.jpeg .gif .png以外の拡張子を持ったファイルが入力されている場合
##　⇒ <<altflow_uc04,代替フロー3に移行>>
** [red]##画像データ登録フォームに10MBを上回るファイルが入力されている場合##　⇒ <<altflow_uc04,代替フロー4に移行>>
. システムは商品IDの生成と税込み価格の算出を実施する
. 登録が完了したことを示すメッセージをメッセージ領域に表示する

+
(参考画像：登録完了後の画面イメージ)
+
image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/afterRegist.png[afterRegist]




|代替フロー
|
[[altflow_uc04]]

. 商品名フォームにシングルクォーテーション(')またはダブルクォーテーション(")が含まれている場合
.. エラーメッセージ06を<<image_editData,商品データ管理画面>>の「⑥メッセージ領域」に表示する
.. <<mainflow_uc04,基本フロー>>のステップ1に戻る

. 価格フォームに整数以外が入力されている場合
.. エラーメッセージ07を<<image_editData,商品データ管理画面>>の「⑥メッセージ領域」に表示する
.. <<mainflow_uc04,基本フロー>>のステップ1に戻る

. 画像データ登録フォームに.jpeg .gif .png以外の拡張子を持ったファイルが入力されている場合
.. エラーメッセージ08を<<image_editData,商品データ管理画面>>の「⑥メッセージ領域」に表示する
.. <<mainflow_uc04,基本フロー>>のステップ1に戻る

. 画像データ登録フォームに10MBを上回るファイルが入力されている場合
.. エラーメッセージ09を<<image_editData,商品データ管理画面>>の「⑥メッセージ領域」に表示する
.. <<mainflow_uc04,基本フロー>>のステップ1に戻る


(参考画像：メッセージ表示後の画面イメージ)

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/regist_message.png[regist_message]

　

|例外フロー
|なし

|事後条件
|<<image_editData,商品データ管理画面>>が表示されている

|補足
|

エラーメッセージ06
....
シングルクォーテーション(')またはダブルクォーテーション(")が含まれる文字列では登録できません
....

エラーメッセージ07
....
フォーム(価格)の入力が正しくありません
(整数で価格を指定してください)
....

エラーメッセージ08
....
画像データのファイル拡張子が正しくありません
(.jpeg .gif .png のみ登録を受け付けます)
....

エラーメッセージ09
....
登録できる画像データの最大サイズを超えています
(10MB以下の画像ファイルをご用意ください)
....


* 商品名,カテゴリ,税抜き価格の3つが入力できている場合のみ登録ボタンが有効になる。

※ 画像データは任意指定とする。指定しなかった場合はサンプル画像(nowPrinting.png)を代わりに登録する

フォーム入力のバリデーション条件を以下に定義する。

* 商品名
** シングルクォーテーション(')、ダブルクォーテーション(")を除く文字列の入力を受け付ける
** 入力可能文字数制限：50文字まで

* カテゴリ
** プルダウンメニューで選択するため、バリデーション条件は特に無し

* 税抜き価格　
** 入力は1以上の整数であること
** 入力可能文字数制限：9文字まで

* 画像データ
** ファイル拡張子が.jpeg .gif .pngのいずれかであること
** ファイルサイズが10MB以下であること

|===
''''

[[image_editData]]
==== 画面仕様：商品データ管理画面

商品一覧画面の仕様と、実現する機能は以下の通りである。

image::https://raw.githubusercontent.com/W-Nakayama-24/ojt_ecsite/develop/UseCase/registimage.png[registimage]

[cols="3*,3a", options="header"]
|===
|No.
|項目名
|種別
|説明

|1
|商品名フォーム
|入力欄
|文字列を入力して商品名を指定する

|2
|カテゴリフォーム
|プルダウンメニュー
|商品カテゴリを指定する

|3
|税抜き価格フォーム
|入力欄
|整数を入力して商品の税抜き価格を指定する

|4
|商品画像データ登録フォーム / 参照ボタン
|ファイル名入力欄 / ボタン
|商品の画像ファイルを指定する

|5
|登録ボタン
|ボタン
|押下すると「<<_商品データを登録する,商品データを登録する>>」機能を実行する
　
|6
|メッセージ領域
|表示領域
|ECサイトから管理者へのメッセージを表示する

|7
|全商品一覧に戻るボタン
|ボタン
|クリックすると<<image_viewall,商品一覧画面>>に遷移する
|===
